# åˆ†æ”¯åç§°ç¿»è¯‘åŠŸèƒ½

## é—®é¢˜æè¿°

åœ¨åˆ›å»ºä»»åŠ¡æ—¶ï¼Œå¦‚æœä»»åŠ¡æ ‡é¢˜æ˜¯å…¨ä¸­æ–‡ï¼ˆæˆ–å…¶ä»–éè‹±æ–‡ã€æ—  ASCII å­—æ¯æ•°å­—å­—ç¬¦çš„æ ‡é¢˜ï¼‰ï¼Œç”Ÿæˆçš„ Git åˆ†æ”¯åç§°ä¼šå˜æˆ `xxxx-` çš„å½¢å¼ï¼Œåé¢æ²¡æœ‰ä»»ä½•æè¿°æ€§å†…å®¹ï¼Œåªæœ‰ä¸€ä¸ª UUID çŸ­ç å‰ç¼€ã€‚

ä¾‹å¦‚ï¼š
- ä»»åŠ¡æ ‡é¢˜ï¼š`ä¿®å¤ç”¨æˆ·ç™»å½•é—®é¢˜`
- æ—§çš„åˆ†æ”¯åç§°ï¼š`a3b2-`ï¼ˆåé¢æ˜¯ç©ºçš„ï¼‰
- æœŸæœ›çš„åˆ†æ”¯åç§°ï¼š`a3b2-fix-user-login`

## è§£å†³æ–¹æ¡ˆ

å®ç°äº†è‡ªåŠ¨ç¿»è¯‘åŠŸèƒ½ï¼Œå½“æ£€æµ‹åˆ°ä»»åŠ¡æ ‡é¢˜ä¸åŒ…å«è‹±æ–‡å­—æ¯æˆ–æ•°å­—æ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨ DeepSeek API å°†æ ‡é¢˜ç¿»è¯‘æˆè‹±æ–‡ï¼Œç„¶åå†ç”Ÿæˆåˆ†æ”¯åç§°ã€‚

### æ¶æ„å˜æ›´

#### 1. æ–°å¢ç¿»è¯‘æ¨¡å— (`crates/utils/src/translate.rs`)

- **`needs_translation(input: &str) -> bool`**: æ£€æµ‹å­—ç¬¦ä¸²æ˜¯å¦éœ€è¦ç¿»è¯‘
  - æ£€æŸ¥æ˜¯å¦åŒ…å« ASCII å­—æ¯æ•°å­—å­—ç¬¦
  - å¦‚æœä¸åŒ…å«ï¼Œè¿”å› `true`ï¼ˆéœ€è¦ç¿»è¯‘ï¼‰

- **`translate_to_english(text: &str) -> String`**: ä½¿ç”¨ DeepSeek API ç¿»è¯‘æ–‡æœ¬
  - è¯»å–ç¯å¢ƒå˜é‡ `DEEPSEEK_API_KEY`
  - å¦‚æœ API key æœªè®¾ç½®ï¼Œç›´æ¥è¿”å›åŸæ–‡ï¼ˆä¸é˜»å¡åŠŸèƒ½ï¼‰
  - è°ƒç”¨ DeepSeek Chat API è¿›è¡Œç¿»è¯‘
  - ä½¿ç”¨ç³»ç»Ÿæç¤ºæŒ‡å¯¼ API ç”Ÿæˆç®€æ´ã€é€‚åˆåˆ†æ”¯åç§°çš„ç¿»è¯‘

#### 2. æ›´æ–°åˆ†æ”¯åç§°ç”Ÿæˆé€»è¾‘ (`crates/utils/src/text.rs`)

- **ä¿ç•™åŸå‡½æ•°**: `git_branch_id(input: &str) -> String`ï¼ˆåŒæ­¥ç‰ˆæœ¬ï¼‰
- **æ–°å¢å¼‚æ­¥å‡½æ•°**: `git_branch_id_with_translation(input: &str) -> String`
  - å…ˆæ£€æŸ¥æ˜¯å¦éœ€è¦ç¿»è¯‘
  - å¦‚æœéœ€è¦ï¼Œè°ƒç”¨ç¿»è¯‘ API
  - ç„¶åä½¿ç”¨ç¿»è¯‘åçš„æ–‡æœ¬ç”Ÿæˆåˆ†æ”¯ ID

#### 3. æ›´æ–°æœåŠ¡è°ƒç”¨ (`crates/services/src/services/container.rs`)

- ä¿®æ”¹ `git_branch_from_workspace` å‡½æ•°
- ä½¿ç”¨æ–°çš„ `git_branch_id_with_translation` æ›¿ä»£æ—§çš„ `git_branch_id`

### å·¥ä½œæµç¨‹

```
ç”¨æˆ·è¾“å…¥ä»»åŠ¡æ ‡é¢˜
    â†“
æ£€æµ‹æ ‡é¢˜æ˜¯å¦åŒ…å«è‹±æ–‡å­—æ¯/æ•°å­—
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   åŒ…å«ï¼Ÿ          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
    Yes â”‚          No
        â”‚            â†“
        â”‚      è°ƒç”¨ DeepSeek API
        â”‚      ç¿»è¯‘æˆè‹±æ–‡
        â”‚            â†“
        â””â”€â”€â†’  ç”Ÿæˆåˆ†æ”¯ IDï¼ˆå–å‰16å­—ç¬¦ï¼‰
                    â†“
              ç»„åˆï¼š{UUIDçŸ­ç }-{åˆ†æ”¯ID}
```

### ç¤ºä¾‹

| ä»»åŠ¡æ ‡é¢˜ | ç¿»è¯‘å | åˆ†æ”¯åç§° |
|---------|--------|----------|
| `ä¿®å¤ç”¨æˆ·ç™»å½•é—®é¢˜` | `Fix user login issue` | `a3b2-fix-user-login` |
| `æ–°å¢æ•°æ®å¯¼å‡ºåŠŸèƒ½` | `Add data export feature` | `b5c7-add-data-export` |
| `Fix user bug` | ï¼ˆä¸ç¿»è¯‘ï¼‰ | `d9e1-fix-user-bug` |
| `ä¿®å¤ API é”™è¯¯` | ï¼ˆä¸ç¿»è¯‘ï¼Œå·²åŒ…å« ASCIIï¼‰ | `f2a8-api` |

## é…ç½®

### ç¯å¢ƒå˜é‡

éœ€è¦è®¾ç½® `DEEPSEEK_API_KEY` ç¯å¢ƒå˜é‡ï¼š

```bash
export DEEPSEEK_API_KEY="sk-your-api-key-here"
```

### å¯é€‰é…ç½®

å¦‚æœæœªè®¾ç½® API keyï¼š
- âœ… åŠŸèƒ½ä»ç„¶å¯ä»¥æ­£å¸¸å·¥ä½œ
- âš ï¸ éè‹±æ–‡æ ‡é¢˜ä¼šç›´æ¥ç”Ÿæˆç©ºçš„åˆ†æ”¯åç§°ï¼ˆå›é€€åˆ°æ—§è¡Œä¸ºï¼‰
- ğŸ“ æ—¥å¿—ä¼šè¾“å‡ºè°ƒè¯•ä¿¡æ¯ï¼š`DEEPSEEK_API_KEY not set, skipping translation`

### DeepSeek API

- **API ç«¯ç‚¹**: `https://api.deepseek.com/chat/completions`
- **æ¨¡å‹**: `deepseek-chat`
- **æ¸©åº¦**: 0.3ï¼ˆè¾ƒä½ï¼Œä¿è¯ä¸€è‡´æ€§ï¼‰
- **æœ€å¤§ Token**: 100ï¼ˆç¿»è¯‘ç®€çŸ­æ ‡é¢˜è¶³å¤Ÿï¼‰

## ä¼˜åŠ¿

1. **è‡ªåŠ¨åŒ–**: æ— éœ€æ‰‹åŠ¨ç¿»è¯‘æˆ–ä¿®æ”¹æ ‡é¢˜
2. **å‘åå…¼å®¹**: è‹±æ–‡æ ‡é¢˜ä¸å—å½±å“
3. **ä¼˜é›…é™çº§**: å¦‚æœ API è°ƒç”¨å¤±è´¥ï¼Œè¿”å›åŸæ ‡é¢˜ï¼ˆä¸ä¼šä¸­æ–­å·¥ä½œæµï¼‰
4. **æˆæœ¬ä½**: åªåœ¨éœ€è¦æ—¶æ‰è°ƒç”¨ API
5. **å¯é…ç½®**: å¯ä»¥é€‰æ‹©æ˜¯å¦å¯ç”¨ç¿»è¯‘åŠŸèƒ½

## æŠ€æœ¯ç»†èŠ‚

### ç¿»è¯‘åˆ¤æ–­é€»è¾‘

```rust
pub fn needs_translation(input: &str) -> bool {
    let has_ascii_alnum = input
        .chars()
        .any(|c| c.is_ascii_alphanumeric());

    !has_ascii_alnum
}
```

### API è¯·æ±‚æ ¼å¼

```json
{
  "model": "deepseek-chat",
  "messages": [
    {
      "role": "system",
      "content": "You are a translator. Translate the following text to English. Only output the translation, nothing else. Keep it concise and suitable for a git branch name (short words preferred)."
    },
    {
      "role": "user",
      "content": "ä¿®å¤ç”¨æˆ·ç™»å½•é—®é¢˜"
    }
  ],
  "temperature": 0.3,
  "max_tokens": 100
}
```

## æµ‹è¯•

è¿è¡Œå•å…ƒæµ‹è¯•ï¼š

```bash
# æµ‹è¯•ç¿»è¯‘æ£€æµ‹é€»è¾‘
cargo test -p utils translate::tests::test_needs_translation

# æµ‹è¯• services é›†æˆ
cargo test -p services --lib
```

### æµ‹è¯•ç”¨ä¾‹

- âœ… å…¨ä¸­æ–‡æ ‡é¢˜éœ€è¦ç¿»è¯‘
- âœ… è‹±æ–‡æ ‡é¢˜ä¸éœ€è¦ç¿»è¯‘
- âœ… ä¸­è‹±æ··åˆæ ‡é¢˜ä¸éœ€è¦ç¿»è¯‘
- âœ… åªæœ‰ç‰¹æ®Šå­—ç¬¦çš„æ ‡é¢˜éœ€è¦ç¿»è¯‘
- âœ… Services é›†æˆæµ‹è¯•å…¨éƒ¨é€šè¿‡

## æœªæ¥æ”¹è¿›

1. **ç¼“å­˜ç¿»è¯‘ç»“æœ**: é¿å…é‡å¤ç¿»è¯‘ç›¸åŒçš„æ ‡é¢˜
2. **æ”¯æŒå…¶ä»–ç¿»è¯‘ API**: å¦‚ OpenAIã€Google Translate
3. **å¯é…ç½®ç¿»è¯‘æ¨¡å‹**: å…è®¸ç”¨æˆ·é€‰æ‹©ä¸åŒçš„ DeepSeek æ¨¡å‹
4. **æ‰¹é‡ç¿»è¯‘**: å¦‚æœæœ‰å¤šä¸ªä»»åŠ¡ï¼Œå¯ä»¥æ‰¹é‡è°ƒç”¨ API
5. **æ›´æ™ºèƒ½çš„æ£€æµ‹**: æ£€æµ‹ä¸»è¦è¯­è¨€ï¼Œè€Œä¸ä»…ä»…æ˜¯æ˜¯å¦åŒ…å« ASCII

## æ–‡ä»¶å˜æ›´

### æ–°å¢æ–‡ä»¶
- `crates/utils/src/translate.rs`

### ä¿®æ”¹æ–‡ä»¶
- `crates/utils/src/lib.rs`
- `crates/utils/src/text.rs`
- `crates/services/src/services/container.rs`

### æ–‡æ¡£
- `docs/BRANCH_NAME_TRANSLATION.md`ï¼ˆæœ¬æ–‡æ¡£ï¼‰
